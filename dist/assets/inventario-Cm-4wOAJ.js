import{c as P,r as a,j as e,G as N,X,a as S,U as ne,A as y,e as ie,d as H,b as oe,C as U,h as ce,R as de}from"./index-BdA2BdX0.js";import{S as xe,T as K,L as he,P as Z,R as $,a as me,b as J,c as ue,I as be}from"./InventoryLogin-D7n5tOcZ.js";import{M as pe}from"./map-pin-BEFsyriq.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=P("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=P("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=P("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=P("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=P("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=P("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),je=({item:t,onSave:x,onClose:o})=>{const[i,b]=a.useState({nombre:"",numero_serie:"",descripcion:"",categoria:"",ubicacion:"",responsable:"",cantidad:1,estado:"Disponible",notas:""});a.useEffect(()=>{t&&b({nombre:t.nombre||"",numero_serie:t.numero_serie||"",descripcion:t.descripcion||"",categoria:t.categoria||"",ubicacion:t.ubicacion||"",responsable:t.responsable||"",cantidad:t.cantidad||1,estado:t.estado||"Disponible",notas:t.notas||""})},[t]);const r=m=>{m.preventDefault(),x(i)},n=m=>{const{name:v,value:p}=m.target;b(h=>({...h,[v]:p}))};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsx(N,{className:"w-full max-w-2xl max-h-[90vh] overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500/20 border border-blue-500/30 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:t?"Editar Item":"Nuevo Item"}),e.jsx("p",{className:"text-white/60 text-sm",children:t?"Modifica la información del item":"Añade un nuevo item al inventario"})]})]}),e.jsx("button",{onClick:o,className:"w-8 h-8 flex items-center justify-center rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(X,{className:"w-5 h-5 text-white/90"})})]}),e.jsxs("form",{onSubmit:r,className:"space-y-4 max-h-[calc(90vh-200px)] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-white/90 text-sm font-medium mb-2",children:["Nombre ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",name:"nombre",value:i.nombre,onChange:n,required:!0,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50",placeholder:"Ej: Arduino Uno"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Número de Serie"}),e.jsx("input",{type:"text",name:"numero_serie",value:i.numero_serie,onChange:n,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50",placeholder:"Ej: SN12345678"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Descripción"}),e.jsx("textarea",{name:"descripcion",value:i.descripcion,onChange:n,rows:2,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50 resize-none",placeholder:"Breve descripción del item..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Categoría"}),e.jsx("input",{type:"text",name:"categoria",value:i.categoria,onChange:n,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50",placeholder:"Ej: Electrónica",list:"categorias"}),e.jsxs("datalist",{id:"categorias",children:[e.jsx("option",{value:"Electrónica"}),e.jsx("option",{value:"Mecánica"}),e.jsx("option",{value:"Software"}),e.jsx("option",{value:"Herramientas"}),e.jsx("option",{value:"Materiales"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Estado"}),e.jsxs("select",{name:"estado",value:i.estado,onChange:n,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-400/50",children:[e.jsx("option",{value:"Disponible",children:"Disponible"}),e.jsx("option",{value:"En uso",children:"En uso"}),e.jsx("option",{value:"Mantenimiento",children:"Mantenimiento"}),e.jsx("option",{value:"Dañado",children:"Dañado"}),e.jsx("option",{value:"Prestado",children:"Prestado"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Ubicación"}),e.jsx("input",{type:"text",name:"ubicacion",value:i.ubicacion,onChange:n,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50",placeholder:"Ej: Lab A, Estante 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Responsable"}),e.jsx("input",{type:"text",name:"responsable",value:i.responsable,onChange:n,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50",placeholder:"Nombre de la persona"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Cantidad"}),e.jsx("input",{type:"number",name:"cantidad",value:i.cantidad,onChange:n,min:"1",className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Notas"}),e.jsx("textarea",{name:"notas",value:i.notas,onChange:n,rows:3,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50 resize-none",placeholder:"Información adicional..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-white/10",children:[e.jsx(S,{type:"button",variant:"secondary",size:"md",onClick:o,children:"Cancelar"}),e.jsxs(S,{type:"submit",variant:"primary",size:"md",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),t?"Guardar Cambios":"Crear Item"]})]})]})]})})})},we=({itemName:t,onConfirm:x,onClose:o})=>e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsx(N,{className:"w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/20 border border-red-500/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-1",children:"Confirmar Eliminación"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Esta acción no se puede deshacer"})]})]}),e.jsx("button",{onClick:o,className:"w-8 h-8 flex items-center justify-center rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(X,{className:"w-5 h-5 text-white/90"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-white/90 mb-2",children:"¿Estás seguro de que deseas eliminar el siguiente item?"}),e.jsxs("p",{className:"text-white font-semibold text-lg",children:['"',t,'"']})]}),e.jsx("p",{className:"text-white/70 text-sm mt-4",children:"El item será eliminado permanentemente del inventario. Esta acción solo está disponible para administradores."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(S,{variant:"secondary",size:"md",onClick:o,children:"Cancelar"}),e.jsxs("button",{onClick:x,className:"px-6 py-2 bg-red-500/80 hover:bg-red-500 text-white font-semibold rounded-lg transition-all flex items-center space-x-2 border border-red-400/30",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Eliminar"})]})]})]})})}),Ne=({user:t,onLogout:x})=>{const[o,i]=a.useState([]),[b,r]=a.useState([]),[n,m]=a.useState(""),[v,p]=a.useState(!0),[h,c]=a.useState(!1),[D,k]=a.useState(!1),[g,E]=a.useState(null),[u,M]=a.useState(null),[f,z]=a.useState(""),[j,d]=a.useState(""),C=async()=>{p(!0);try{const l=await(await fetch(y.items,{credentials:"include"})).json();l.success&&(i(l.items),r(l.items))}catch(s){console.error("Error al cargar items:",s)}finally{p(!1)}},w=async()=>{try{const l=await(await fetch(y.stats,{credentials:"include"})).json();l.success&&M(l.stats)}catch(s){console.error("Error al cargar estadísticas:",s)}};a.useEffect(()=>{C(),w()},[]),a.useEffect(()=>{let s=o;if(n){const l=n.toLowerCase();s=s.filter(I=>{var _,O,G,V;return I.nombre.toLowerCase().includes(l)||((_=I.numero_serie)==null?void 0:_.toLowerCase().includes(l))||((O=I.descripcion)==null?void 0:O.toLowerCase().includes(l))||((G=I.ubicacion)==null?void 0:G.toLowerCase().includes(l))||((V=I.responsable)==null?void 0:V.toLowerCase().includes(l))})}f&&(s=s.filter(l=>l.categoria===f)),j&&(s=s.filter(l=>l.estado===j)),r(s)},[n,o,f,j]);const A=async()=>{try{await fetch(y.logout,{method:"POST",credentials:"include"}),x()}catch(s){console.error("Error al cerrar sesión:",s)}},F=()=>{E(null),c(!0)},Q=s=>{E(s),c(!0)},W=s=>{E(s),k(!0)},Y=async s=>{try{const l=g?y.itemById(g.id):y.items;(await(await fetch(l,{method:g?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)})).json()).success&&(c(!1),C(),w())}catch(l){console.error("Error al guardar item:",l)}},ee=async()=>{if(g)try{(await(await fetch(y.itemById(g.id),{method:"DELETE",credentials:"include"})).json()).success&&(k(!1),C(),w())}catch(s){console.error("Error al eliminar item:",s)}},se=s=>{switch(s){case"Disponible":return e.jsx(U,{className:"w-4 h-4 text-green-400"});case"En uso":return e.jsx(oe,{className:"w-4 h-4 text-blue-400"});case"Mantenimiento":return e.jsx(H,{className:"w-4 h-4 text-yellow-400"});case"Dañado":return e.jsx(ie,{className:"w-4 h-4 text-red-400"});default:return e.jsx(L,{className:"w-4 h-4 text-gray-400"})}},te=s=>{switch(s){case"admin":return"bg-purple-500/20 text-purple-300 border-purple-500/30";case"manager":return"bg-blue-500/20 text-blue-300 border-blue-500/30";case"viewer":return"bg-green-500/20 text-green-300 border-green-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}},T=t.rol==="manager"||t.rol==="admin",ae=t.rol==="admin",re=[...new Set(o.map(s=>s.categoria).filter(Boolean))],le=[...new Set(o.map(s=>s.estado))];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-4 md:p-8",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[e.jsx(N,{className:"mb-6",children:e.jsxs("div",{className:"p-6 flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Sistema de Inventario"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-white/70",children:["Bienvenido, ",e.jsx("span",{className:"font-semibold text-white",children:t.nombre_completo})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${te(t.rol)}`,children:t.rol.toUpperCase()})]})]}),e.jsxs(S,{variant:"secondary",size:"md",onClick:A,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Cerrar Sesión"]})]})}),u&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(N,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(L,{className:"w-8 h-8 text-blue-400"}),e.jsx(q,{className:"w-5 h-5 text-white/40"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:u.totalItems}),e.jsx("div",{className:"text-white/60 text-sm",children:"Total Items"})]})}),e.jsx(N,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pe,{className:"w-8 h-8 text-purple-400"}),e.jsx(q,{className:"w-5 h-5 text-white/40"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:u.byLocation.length}),e.jsx("div",{className:"text-white/60 text-sm",children:"Ubicaciones"})]})}),e.jsx(N,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ne,{className:"w-8 h-8 text-orange-400"}),e.jsx(q,{className:"w-5 h-5 text-white/40"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:u.byCategory.length}),e.jsx("div",{className:"text-white/60 text-sm",children:"Categorías"})]})})]}),e.jsx(N,{className:"mb-6",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(fe,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/40"}),e.jsx("input",{type:"text",value:n,onChange:s=>m(s.target.value),placeholder:"Buscar por nombre, número de serie, ubicación, responsable...",className:"w-full pl-12 pr-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent transition-all"})]}),e.jsxs("div",{className:"flex gap-2",children:[T&&e.jsxs(S,{variant:"primary",size:"md",onClick:F,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Nuevo Item"]}),e.jsx(S,{variant:"secondary",size:"md",onClick:C,children:e.jsx($,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("select",{value:f,onChange:s=>z(s.target.value),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-400/50",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),re.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:j,onChange:s=>d(s.target.value),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-400/50",children:[e.jsx("option",{value:"",children:"Todos los estados"}),le.map(s=>e.jsx("option",{value:s,children:s},s))]}),(f||j)&&e.jsx("button",{onClick:()=>{z(""),d("")},className:"px-4 py-2 text-white/70 hover:text-white text-sm transition-colors",children:"Limpiar filtros"})]})]})}),e.jsx(N,{children:e.jsx("div",{className:"overflow-x-auto",children:v?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx($,{className:"w-8 h-8 text-white/40 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"Cargando inventario..."})]}):b.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(L,{className:"w-12 h-12 text-white/40 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60 mb-2",children:n||f||j?"No se encontraron items con los filtros aplicados":"No hay items en el inventario"}),T&&!n&&!f&&!j&&e.jsxs(S,{variant:"primary",size:"sm",onClick:F,className:"mt-4",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Añadir Primer Item"]})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-left p-4 text-white/80 font-semibold text-sm",children:"Nombre"}),e.jsx("th",{className:"text-left p-4 text-white/80 font-semibold text-sm",children:"Nº Serie"}),e.jsx("th",{className:"text-left p-4 text-white/80 font-semibold text-sm",children:"Categoría"}),e.jsx("th",{className:"text-left p-4 text-white/80 font-semibold text-sm",children:"Ubicación"}),e.jsx("th",{className:"text-left p-4 text-white/80 font-semibold text-sm",children:"Responsable"}),e.jsx("th",{className:"text-left p-4 text-white/80 font-semibold text-sm",children:"Cantidad"}),e.jsx("th",{className:"text-left p-4 text-white/80 font-semibold text-sm",children:"Estado"}),e.jsx("th",{className:"text-right p-4 text-white/80 font-semibold text-sm",children:"Acciones"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-white",children:s.nombre}),s.descripcion&&e.jsx("div",{className:"text-xs text-white/60 mt-1",children:s.descripcion})]}),e.jsx("td",{className:"p-4 text-white/70 text-sm",children:s.numero_serie||"-"}),e.jsx("td",{className:"p-4",children:s.categoria&&e.jsx("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 text-xs rounded-full",children:s.categoria})}),e.jsx("td",{className:"p-4 text-white/70 text-sm",children:s.ubicacion||"-"}),e.jsx("td",{className:"p-4 text-white/70 text-sm",children:s.responsable||"-"}),e.jsx("td",{className:"p-4 text-white/70 text-sm text-center",children:s.cantidad}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[se(s.estado),e.jsx("span",{className:"text-white/70 text-sm",children:s.estado})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[T&&e.jsx("button",{onClick:()=>Q(s),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",title:"Editar",children:e.jsx(me,{className:"w-4 h-4 text-blue-400"})}),ae&&e.jsx("button",{onClick:()=>W(s),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",title:"Eliminar",children:e.jsx(K,{className:"w-4 h-4 text-red-400"})})]})})]},s.id))})]})})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-white/40 text-sm",children:["Mostrando ",b.length," de ",o.length," items"]})})]}),h&&e.jsx(je,{item:g,onSave:Y,onClose:()=>c(!1)}),D&&g&&e.jsx(we,{itemName:g.nombre,onConfirm:ee,onClose:()=>k(!1)})]})},ye=({isFirstTime:t=!1,onSuccess:x,onCancel:o})=>{const[i,b]=a.useState(""),[r,n]=a.useState(""),[m,v]=a.useState(""),[p,h]=a.useState(!1),[c,D]=a.useState(!1),[k,g]=a.useState(!1),[E,u]=a.useState(""),[M,f]=a.useState(!1),z=d=>d.length<6?"La contraseña debe tener al menos 6 caracteres":d==="cambiarme123"?"No puedes usar la contraseña por defecto":null,j=async d=>{if(d.preventDefault(),u(""),!i||!r||!m){u("Todos los campos son obligatorios");return}const C=z(r);if(C){u(C);return}if(r!==m){u("Las contraseñas no coinciden");return}if(i===r){u("La nueva contraseña debe ser diferente a la actual");return}f(!0);try{const w=await fetch(y.changePassword,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({current_password:i,new_password:r})}),A=await w.json();if(!w.ok)throw new Error(A.error||"Error al cambiar la contraseña");x()}catch(w){u(w instanceof Error?w.message:"Error al cambiar la contraseña")}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:e.jsx(J,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t?"Cambiar Contraseña":"Actualizar Contraseña"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t?"Primera vez - Cambio obligatorio":"Configuración de seguridad"})]})]}),t&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Debes cambiar tu contraseña"}),e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mt-1",children:"Por seguridad, es obligatorio cambiar la contraseña temporal en el primer acceso."})]})]})}),E&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:E})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Contraseña Actual"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:p?"text":"password",value:i,onChange:d=>b(d.target.value),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white pr-12",placeholder:"Tu contraseña actual",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:p?e.jsx(B,{size:20}):e.jsx(R,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nueva Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c?"text":"password",value:r,onChange:d=>n(d.target.value),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white pr-12",placeholder:"Mínimo 6 caracteres",required:!0}),e.jsx("button",{type:"button",onClick:()=>D(!c),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:c?e.jsx(B,{size:20}):e.jsx(R,{size:20})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:'Mínimo 6 caracteres, no uses "cambiarme123"'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Confirmar Nueva Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:k?"text":"password",value:m,onChange:d=>v(d.target.value),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white pr-12",placeholder:"Repite tu nueva contraseña",required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:k?e.jsx(B,{size:20}):e.jsx(R,{size:20})})]})]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(U,{className:`w-4 h-4 ${r.length>=6?"text-green-500":"text-gray-400"}`}),e.jsx("span",{className:r.length>=6?"text-green-600 dark:text-green-400":"text-gray-500",children:"Al menos 6 caracteres"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(U,{className:`w-4 h-4 ${r!=="cambiarme123"?"text-green-500":"text-gray-400"}`}),e.jsx("span",{className:r!=="cambiarme123"?"text-green-600 dark:text-green-400":"text-gray-500",children:"No es la contraseña por defecto"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[!t&&o&&e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors font-medium",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:M,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{size:20}),"Cambiar Contraseña"]})})]})]})]})})},ve=()=>{const[t,x]=a.useState(null),[o,i]=a.useState(!0),[b,r]=a.useState(!1);a.useEffect(()=>{n()},[]);const n=async()=>{try{const h=await fetch(y.verify,{credentials:"include"});if(h.ok){const c=await h.json();c.success&&c.user&&(x(c.user),c.user.requiere_cambio_password&&r(!0))}}catch(h){console.error("Error al verificar sesión:",h)}finally{i(!1)}},m=(h,c)=>{x(h),c&&r(!0)},v=()=>{r(!1),t&&x({...t,requiere_cambio_password:!1})},p=()=>{x(null),r(!1)};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"w-12 h-12 text-white/40 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"Verificando sesión..."})]})}):e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{user:t,onLogout:p}),b&&e.jsx(ye,{isFirstTime:!0,onSuccess:v})]}):e.jsx(be,{onLoginSuccess:m})})};ce.createRoot(document.getElementById("root")).render(e.jsx(de.StrictMode,{children:e.jsx(ve,{})}));
